.PHONY: help run build demo clean test install

# Default target
help:
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "ğŸš€ AgentOS Ollama Cloud - Makefile Commands"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@echo "Available commands:"
	@echo "  make run          - Run AgentOS server"
	@echo "  make build        - Build binary"
	@echo "  make demo         - Run demo script (server must be running)"
	@echo "  make test         - Run tests"
	@echo "  make clean        - Clean build artifacts"
	@echo "  make install      - Install dependencies"
	@echo ""
	@echo "Setup:"
	@echo "  1. Copy .env.example to .env"
	@echo "  2. Add your OLLAMA_CLOUD_API_KEY"
	@echo "  3. Run 'make run'"
	@echo ""

# Run the server
run:
	@echo "ğŸš€ Starting AgentOS with Ollama Cloud..."
	@if [ ! -f .env ]; then \
		echo "âš ï¸  .env file not found. Creating from .env.example..."; \
		cp .env.example .env; \
		echo "ğŸ“ Please edit .env and add your OLLAMA_CLOUD_API_KEY"; \
		exit 1; \
	fi
	@export $$(cat .env | xargs) && go run main.go

# Build binary
build:
	@echo "ğŸ”¨ Building AgentOS binary..."
	@go build -o agentos-ollama-cloud main.go
	@echo "âœ… Built: agentos-ollama-cloud"

# Run demo script
demo:
	@echo "ğŸ¬ Running demo script..."
	@./demo.sh

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	@go test -v

# Clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@rm -f agentos-ollama-cloud
	@rm -f *.log
	@echo "âœ… Cleaned"

# Install dependencies
install:
	@echo "ğŸ“¦ Installing dependencies..."
	@go mod download
	@go mod tidy
	@echo "âœ… Dependencies installed"

# Development mode with auto-reload (requires air)
dev:
	@if ! command -v air > /dev/null; then \
		echo "ğŸ“¦ Installing air for auto-reload..."; \
		go install github.com/cosmtrek/air@latest; \
	fi
	@export $$(cat .env | xargs) && air

# Docker build
docker-build:
	@echo "ğŸ³ Building Docker image..."
	@docker build -t agentos-ollama-cloud .
	@echo "âœ… Docker image built: agentos-ollama-cloud"

# Docker run
docker-run:
	@echo "ğŸ³ Running Docker container..."
	@docker run -p 8080:8080 --env-file .env agentos-ollama-cloud
